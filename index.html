<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BBB Golf PWA</title>
  <meta name="theme-color" content="#1a1a1a" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <link rel="icon" href="icon-192.png" />

  <style>
    :root {
      --bg: #1a1a1a;
      --surface: #2a2a2a;
      --text: #e0e0e0;
      --text-muted: #aaaaaa;
      --primary: #4caf50;
      --accent: #ff9800;
      --danger: #f44336;
      --success: #66bb6a;
      --border: #444;
    }

    [data-theme="light"] {
      --bg: #f5f5f5;
      --surface: #ffffff;
      --text: #212121;
      --text-muted: #666666;
      --primary: #388e3c;
      --accent: #f57c00;
      --danger: #d32f2f;
      --success: #43a047;
      --border: #ddd;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 1rem;
      line-height: 1.5;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    h1, h2, h3 {
      margin-bottom: 1rem;
      color: var(--primary);
    }

    button {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s;
    }

    button:hover {
      background: var(--primary);
      color: white;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    input[type="checkbox"] {
      transform: scale(1.3);
      margin: 0 0.5rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      background: var(--surface);
    }

    th, td {
      border: 1px solid var(--border);
      padding: 0.75rem;
      text-align: center;
    }

    th {
      background: var(--bg);
      font-weight: 600;
    }

    .hidden { display: none !important; }

    .player-name {
      font-weight: 600;
    }

    .gir { color: var(--success); font-weight: bold; }

    .audit-good { color: var(--success); }
    .audit-bad { color: var(--danger); }

    .cb-mode .gir { color: #ffeb3b !important; }

    /* DEBUG PANEL */
    #debugPanel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 90%;
      max-width: 800px;
      max-height: 70vh;
      overflow-y: auto;
      background: #111;
      border: 2px solid #0f0;
      border-radius: 8px;
      padding: 1rem;
      color: #0f0;
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
      z-index: 9999;
      box-shadow: 0 0 20px rgba(0,255,0,0.3);
    }

    #debugPanel.hidden { display: none; }

    #debugPanel h4 {
      margin: 0 0 0.5rem;
      color: #0f0;
      font-size: 1rem;
    }

    #debugPanel table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
      font-size: 0.75rem;
    }

    #debugPanel th, #debugPanel td {
      border: 1px solid #444;
      padding: 4px;
      text-align: center;
    }

    #debugPanel th {
      background: #222;
      font-weight: bold;
    }

    #closeDebug {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #f00;
      color: #fff;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }

    /* === FIX: ALLOW CLICKS THROUGH SUMMARY & AUDIT === */
    #holeSummary,
    #runningAudit {
      pointer-events: none;
    }

    /* === BUT LET CHECKBOXES BE CLICKABLE === */
    #scoreTable input[type="checkbox"] {
      pointer-events: auto !important;
      position: relative;
      z-index: 10;
    }

    /* Responsive */
    @media (max-width: 600px) {
      th, td { padding: 0.5rem; font-size: 0.9rem; }
      #debugPanel { width: 95%; font-size: 0.7rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- COURSE SETUP -->
    <section id="courseSetup">
      <h1>BBB Golf</h1>
      <button id="darkModeToggle">Light</button>
      <button id="cbToggle">CB</button>
      <button id="manageRosterBtn">Roster</button>
      <button id="historyBtn">History</button>

      <h2>Select Course</h2>
      <select id="courseSelect"></select>
      <button id="addCourse">+ New Course</button>
      <button id="nextToPlayers" disabled>Next</button>
    </section>

    <!-- PLAYER SETUP -->
    <section id="playerSetup" class="hidden">
      <h2>Select Players</h2>
      <div id="playerSelect"></div>
      <button id="backToCourse">Back</button>
      <button id="startGame" disabled>Start Game</button>
    </section>

    <!-- ROSTER MANAGEMENT -->
    <section id="roster" class="hidden">
      <h2>Manage Roster</h2>
      <input id="rosterName" placeholder="Name" />
      <input id="rosterPhone" placeholder="Phone" />
      <input id="rosterEmail" placeholder="Email" />
      <button id="addToRoster">+ Add</button>
      <div id="rosterList"></div>
      <button id="backToCourseFromRoster">Back</button>
    </section>

    <!-- COURSE FORM -->
    <section id="courseForm" class="hidden">
      <h2>New Course</h2>
      <input id="courseName" placeholder="Course Name" />
      <div id="pars"></div>
      <button id="saveCourse">Save</button>
      <button id="cancelCourse">Cancel</button>
    </section>

    <!-- START HOLE MODAL -->
    <div id="startHoleModal" class="hidden" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:100;">
      <div style="background:var(--surface);padding:2rem;border-radius:12px;max-width:90%;">
        <h3>Select Starting Hole</h3>
        <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:0.5rem;margin:1rem 0;">
          <label><input type="radio" name="startHole" value="1">1</label>
          <label><input type="radio" name="startHole" value="2">2</label>
          <label><input type="radio" name="startHole" value="3">3</label>
          <label><input type="radio" name="startHole" value="4">4</label>
          <label><input type="radio" name="startHole" value="5">5</label>
          <label><input type="radio" name="startHole" value="6">6</label>
          <label><input type="radio" name="startHole" value="7">7</label>
          <label><input type="radio" name="startHole" value="8">8</label>
          <label><input type="radio" name="startHole" value="9">9</label>
          <label><input type="radio" name="startHole" value="10">10</label>
          <label><input type="radio" name="startHole" value="11">11</label>
          <label><input type="radio" name="startHole" value="12">12</label>
          <label><input type="radio" name="startHole" value="13">13</label>
          <label><input type="radio" name="startHole" value="14">14</label>
          <label><input type="radio" name="startHole" value="15">15</label>
          <label><input type="radio" name="startHole" value="16">16</label>
          <label><input type="radio" name="startHole" value="17">17</label>
          <label><input type="radio" name="startHole" value="18">18</label>
        </div>
        <button id="confirmStartHole">Start</button>
        <button id="cancelStartHole">Cancel</button>
      </div>
    </div>

    <!-- GAME SCREEN -->
    <section id="game" class="hidden">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
        <h2 id="holeDisplay"></h2>
        <div>
          <button id="prevHole">Previous</button>
          <button id="nextHole">Next</button>
        </div>
      </div>

      <table id="scoreTable">
        <thead>
          <tr>
            <th>Player</th>
            <th id="firstOnHeader">First On</th>
            <th>Closest</th>
            <th>Putt</th>
            <th>Hole</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="holeSummary"></div>
      <div id="runningAudit"></div>

      <div style="margin-top:1rem;">
        <button id="finishHole">Finish Hole</button>
        <button id="editHole" class="hidden">Edit Hole</button>
      </div>

      <div style="margin-top:1rem;display:flex;gap:0.5rem;flex-wrap:wrap;">
        <button id="completeRound" class="btn">Complete Round</button>
        <button id="sendSMS">SMS</button>
        <button id="exportCSV">CSV</button>
      </div>
    </section>

    <!-- SUMMARY -->
    <section id="summary" class="hidden">
      <h2>Round Complete!</h2>
      <ol id="leaderboard"></ol>
      <button id="completeRound" class="hidden">View Summary</button>
      <button id="saveRound">Save Round</button>
      <button id="exitRound">Exit</button>
      <button id="restart">Restart App</button>
    </section>

    <!-- HISTORY -->
    <section id="history" class="hidden">
      <h2>Round History</h2>
      <div id="historyList"></div>
      <button id="backToSetup">Back</button>
    </section>
  </div>

  <!-- DEBUG PANEL -->
  <div id="debugPanel" class="hidden">
    <button id="closeDebug">X</button>
    <div id="debugOutput"></div>
  </div>

  <script src="app.js"></script>

  <!-- PWA Install Prompt -->
  <script>
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      const installBtn = document.createElement('button');
      installBtn.textContent = 'Install App';
      installBtn.style.position = 'fixed';
      installBtn.style.bottom = '20px';
      installBtn.style.left = '20px';
      installBtn.style.zIndex = '1000';
      installBtn.onclick = () => {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(() => {
          installBtn.remove();
        });
      };
      document.body.appendChild(installBtn);
    });
  </script>
</body>
</html>